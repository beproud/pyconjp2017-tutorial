=======================
第2部 pip
=======================

第2部では、より実用的なスクリプト開発に向けて、ローカルでのPythonの使い方、公開されたサードパーティのパッケージを使う方法を学びます。

画像処理ライブラリ **Pillow** を題材に、
実際にサードパーティのパッケージをインストールして、Python コードから利用してみましょう。

.. note::

  サードパーティパッケージは、第三者が公開しているパッケージのことです。

  パッケージ内には、コマンドラインツールや
  Pythonスクリプトから使えるモジュール郡などが含まれています。

  このモジュールはライブラリと呼ばれます。

pipを使ってみよう
=================

サードパーティパッケージは、
**pip** というコマンドを用いて自分の環境にインストールことができます。
これは、PHPの ``composer`` コマンドやJavaScriptの ``npm`` コマンドに相当します。

pipでインストールできるサードパーティのパッケージは、
**Python Package Index** (PyPI: https://pypi.python.org/pypi) に登録されています。

PyPIには、DjangoやFlaskといったWeb開発のためのフレームワークをはじめ、
numpyなどの数値計算ライブラリやプロビジョニングツールのAnsibleなど、
様々なパッケージが登録されており、pipで簡単にインストールすることができます。

これらのパッケージは、画像編集スクリプトといった、実用的なスクリプト開発の助けになり、
また、ライセンス次第ですが、多くのパッケージは無料で使うことができます。

もちろんこれから使うPillowもPyPIに登録されているのでpipでインストールすることができます。

pipのインストール
-----------------

pipのインストール方法はOSによって異なります。

:Ubuntu: get-pip.py
:Windows/OSX: 公式インストーラーにバンドル

.. note::

  ``$`` の後にコマンドが続いている表記は、
  ターミナル・コマンドプロンプトでコマンドを入力することを想定しています。

  ``$ python my_script.py``


Windows/OSX
~~~~~~~~~~~

Windows/OSX の場合、
Pythonをインストールした際にpipも一緒にインストールされており、
別途インストールする必要はありません。

.. warning::

  ただし、Pythonの公式 (python.org) のインストーラ以外でインストールした場合はこの限りではありません。

Ubuntu
~~~~~~

Ubuntuにpipをインストールするには、PyPIが配布している ``get-pip.py`` というインストールスクリプトを用います。

以下のコマンドでpipをインストールします。

::

  $ curl https://bootstrap.pypa.io/get-pip.py | sudo python3

.. caution::

  ``python`` コマンドではなく ``python3`` コマンドを使うことに注意してください。
  ``python`` コマンドを使うと、 Python 2 用に pip がインストールされてしまいます。

  Ubuntu では、今後も引き続き ``python`` コマンドではなく ``python3`` コマンドを用います

.. note::

  ``curl`` コマンドがインストールされていない場合は、
  ``sudo apt-get install -y curl`` でインストールできます。


このままだとpipでパッケージインストール時にroot権限が必要となるので、
ホームディレクトリ下のパッケージインストール用ディレクトリにインストールされるように設定します。

::

  $ mkdir -p ~/.config/pip/
  $ echo -e '[install]\nuser = yes' > ~/.config/pip/pip.conf

これでインストールは完了です。

pipのバージョン確認
-------------------

次に、pipが正しくインストールされているかを確認しましょう。

以下のコマンドを実行してください。

::

  $ pip --version
  pip 8.1.2 from /usr/local/lib/python3.4/dist-packages (python 3.4)

この出力はそれぞれ次のような意味です。

- ``pip 8.1.2`` pip のバージョン
- ``from /usr/local/lib/python3.4/dist-packages`` pipでインストールされたパッケージが配置されるディレクトリ
- ``(python 3.4)`` pip が動いてるPythonのバージョン

この出力から以下のことが確認できれば、無事にpipがインストールできています

- pip のバージョンが 8 以上 (``8.0.0``, ``8.1.2`` など)
- Python のバージョンが 3.4 または 3.5

.. note::

  Windows の方へ: ディレクトリとはWindowsでいうフォルダーに相当するものです。

.. todo:: え！？問題があった！？その時は講師を呼んでください

Pillowをインストールしよう
==========================

pipがインストールできたので、さっそくパッケージをインストールしてみましょう。

今回は、Pillowという画像処理用のライブラリをインストールします。

Pillowは画像処理を行うライブラリで、画像の縮小や切り取りをはじめ、
様々な画像編集を行うことができます。

.. figure:: ../image/recursive.png

  作例 1

.. figure:: ../image/rotate.png

  作例 2

pipでパッケージをインストールするには ``pip install`` コマンドを使います。

以下のコマンドを実行してPillowをインストールしてください。

::

  $ pip install Pillow

では、インストールができたことを確認してみましょう。
インストールされているパッケージを確認するには、 ``pip freeze`` コマンドを実行します

::

  $ pip freeze
  Pillow==3.3.1

``==`` の左側がインストールしたパッケージ名、右側がパッケージのバージョンです。
Pillow が無事インストールされていれば、上記のような表示が得られます。

.. note::

  インストールしたタイミングによってはバージョンが異なる場合がありますが問題ありません。

.. note::

  インストールしたパッケージを削除するには、 ``pip uninstall パッケージ名`` というコマンド使います。
  例えば、 Pillow を削除するには ``pip uninstall Pillow`` とします。

  参考: https://pip.pypa.io/en/stable/user_guide/

まとめ
========

第2部では次のことを学びました。

- [ ] pipのインストール
- [ ] pipによるサードパーティパッケージのインストール

`3部 <3.rst>`_ ではこれらを踏まえて、より実用的なスクリプトの作成方法について学びます。
